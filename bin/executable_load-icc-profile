#!/bin/bash
# Load ICC color profile for MAG274QRF-QD monitor
# Uses dispwin from ArgyllCMS to load calibration LUT to GPU

ICC_PROFILE="$HOME/.local/share/color/icc/MAG274QRF-QD.icm"

if [ ! -f "$ICC_PROFILE" ]; then
    echo "ICC profile not found: $ICC_PROFILE"
    echo ""
    echo "To set up your DisplayCAL profile:"
    echo "1. Copy from Windows:"
    echo "   C:\\Users\\matas\\AppData\\Roaming\\DisplayCAL\\storage\\MAG274QRF-QD #1 2024-03-05 18-27 119.5cdmÂ² 0.3127x 0.329y sRGB M-S XYZLUT+MTX\\*.icm"
    echo ""
    echo "2. Place at: $ICC_PROFILE"
    exit 1
fi

if ! command -v dispwin &> /dev/null; then
    echo "dispwin not found. Install argyllcms:"
    echo "  sudo pacman -S argyllcms"
    exit 1
fi

# Load profile to display 1 (primary monitor)
# -d 1 = display 1
# -c = calibrate (load LUT curves)
# Use -I for installing as system default (optional)
echo "Loading ICC profile: $ICC_PROFILE"
dispwin -d 1 -c "$ICC_PROFILE"

if [ $? -eq 0 ]; then
    echo "ICC profile loaded successfully"
    notify-send "Color Profile" "MAG274QRF-QD calibration loaded" 2>/dev/null || true
else
    echo "Failed to load ICC profile"
    exit 1
fi
